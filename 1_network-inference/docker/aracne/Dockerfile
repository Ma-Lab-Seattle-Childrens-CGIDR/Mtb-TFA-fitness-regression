# NOTE: the license terms of ARACNe-AP do not allow direct distribution of the
# software. Distribution of IMAGES generated by this dockerfile would likely
# constitute distribution of the software itself, as the image would contain
# a copy of the software. However, distribution of just this DOCKERFILE does
# not constitute distribution of said software, as it only provides a URL with
# which to obtain a copy of the software from an apparent agent of the
# copyright holders (i.e., GitHub).

FROM alpine:3.19.1 AS build

WORKDIR /root

RUN apk add --no-cache apache-ant curl openjdk11-jdk

RUN curl -L --max-redirs 3 "https://github.com/califano-lab/ARACNe-AP/archive/30967ea10494fcb42c2bfd00604c94907da5397b.zip" -o aracne-ap.zip
RUN unzip aracne-ap.zip -d .
RUN mv ARACNe-AP-30967ea10494fcb42c2bfd00604c94907da5397b/* .
RUN rm *.zip

RUN ant main

# ---------------------------------------- #

FROM alpine:3.19.1

RUN apk add --no-cache bash openjdk11-jre-headless
RUN apk add --no-cache -X http://dl-cdn.alpinelinux.org/alpine/edge/testing datamash

WORKDIR /root

COPY --from=build /root /root

ADD aracne_execute.sh aracne_execute.sh

RUN chmod +x aracne_example.sh aracne_execute.sh

RUN mkdir /root/mount
VOLUME /root/mount

# Gene expression input must be a text file, tab separated, with genes on columns and samples on rows
# Regulator input must be a text file, containing one gene symbol per line

ENTRYPOINT ["./aracne_execute.sh"]

CMD ["test/matrix.txt", "test/tfs.txt", "mount/aracne_network.txt"]

# Run with `docker run -it --volume ./mount:/root/mount aracne mount/expression.tsv mount/regulators.tsv mount/output.txt`
# `mount` should be a directory, and should contain the relevant input files,
# which must also be passed as arguments to the script (as shown above).
# Script output will also be written to the `mount` directory, at the location specified (by argument).
# Additional arguments may be supplied:
# - p_value: the p-value threshold for MI significance (defaults to 1E-8)
# - threads: the number of threads to use when calculating mutual information (defaults to 4)
# - bootstraps: the number of times to run aracne with random bootstraps of the network (defaults to 10)
